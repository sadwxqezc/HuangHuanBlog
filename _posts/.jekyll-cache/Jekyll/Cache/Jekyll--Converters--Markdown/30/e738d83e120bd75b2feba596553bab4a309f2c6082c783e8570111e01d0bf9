I"<ul id="markdown-toc">
  <li><a href="#é¢å‘å¯¹è±¡è®¾è®¡oodçš„ä¸ƒå¤§åŸåˆ™" id="markdown-toc-é¢å‘å¯¹è±¡è®¾è®¡oodçš„ä¸ƒå¤§åŸåˆ™">é¢å‘å¯¹è±¡è®¾è®¡(OOD)çš„ä¸ƒå¤§åŸåˆ™</a>    <ul>
      <li><a href="#å¼€é—­åŸåˆ™" id="markdown-toc-å¼€é—­åŸåˆ™">å¼€é—­åŸåˆ™</a></li>
      <li><a href="#é‡Œå¼æ›¿æ¢åŸåˆ™" id="markdown-toc-é‡Œå¼æ›¿æ¢åŸåˆ™">é‡Œå¼æ›¿æ¢åŸåˆ™</a></li>
      <li><a href="#ä¾èµ–å€’ç½®åŸåˆ™" id="markdown-toc-ä¾èµ–å€’ç½®åŸåˆ™">ä¾èµ–å€’ç½®åŸåˆ™</a></li>
      <li><a href="#æ¥å£éš”ç¦»åŸåˆ™" id="markdown-toc-æ¥å£éš”ç¦»åŸåˆ™">æ¥å£éš”ç¦»åŸåˆ™</a></li>
      <li><a href="#å•ä¸€èŒè´£åŸåˆ™" id="markdown-toc-å•ä¸€èŒè´£åŸåˆ™">å•ä¸€èŒè´£åŸåˆ™</a></li>
      <li><a href="#è¿ªç±³ç‰¹æ³•åˆ™" id="markdown-toc-è¿ªç±³ç‰¹æ³•åˆ™">è¿ªç±³ç‰¹æ³•åˆ™</a></li>
      <li><a href="#åˆæˆèšåˆå¤ç”¨åŸåˆ™" id="markdown-toc-åˆæˆèšåˆå¤ç”¨åŸåˆ™">åˆæˆ/èšåˆå¤ç”¨åŸåˆ™</a></li>
      <li><a href="#å…³äºé™æ€æ–¹æ³•" id="markdown-toc-å…³äºé™æ€æ–¹æ³•">å…³äºé™æ€æ–¹æ³•</a></li>
    </ul>
  </li>
  <li><a href="#å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼" id="markdown-toc-å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼">å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼</a>    <ul>
      <li><a href="#builderæ¨¡å¼" id="markdown-toc-builderæ¨¡å¼">Builderæ¨¡å¼</a></li>
      <li><a href="#ç­–ç•¥æ¨¡å¼å’Œç®€å•å·¥å‚æ¨¡å¼" id="markdown-toc-ç­–ç•¥æ¨¡å¼å’Œç®€å•å·¥å‚æ¨¡å¼">ç­–ç•¥æ¨¡å¼å’Œç®€å•å·¥å‚æ¨¡å¼</a></li>
      <li><a href="#è´£ä»»é“¾æ¨¡å¼" id="markdown-toc-è´£ä»»é“¾æ¨¡å¼">è´£ä»»é“¾æ¨¡å¼</a></li>
      <li><a href="#è£…é¥°å™¨æ¨¡å¼" id="markdown-toc-è£…é¥°å™¨æ¨¡å¼">è£…é¥°å™¨æ¨¡å¼</a></li>
      <li><a href="#è§‚å¯Ÿè€…æ¨¡å¼" id="markdown-toc-è§‚å¯Ÿè€…æ¨¡å¼">è§‚å¯Ÿè€…æ¨¡å¼</a></li>
    </ul>
  </li>
</ul>

<p>è®²ä¸€è®²åœ¨å·¥ä½œä¸­ç”¨åˆ°çš„é¢å‘å¯¹è±¡è®¾è®¡æ¨¡å¼ï¼Œä¾›å¤§å®¶å‚è€ƒï¼Œä¹‹åä¹Ÿä¼šç»§ç»­æ›´æ–°ã€‚</p>

<h2 id="é¢å‘å¯¹è±¡è®¾è®¡oodçš„ä¸ƒå¤§åŸåˆ™">é¢å‘å¯¹è±¡è®¾è®¡(OOD)çš„ä¸ƒå¤§åŸåˆ™</h2>

<p>åœ¨é¢å‘å¯¹è±¡è®¾è®¡ä¸­ï¼Œé¦–å…ˆæœ‰è¿™å‡ å¤§åŸåˆ™ä½œä¸ºå‰æï¼Œç„¶ååœ¨æ­¤åŸºç¡€ä¹‹ä¸Šæœ‰äº†å„ç±»è®¾è®¡æ¨¡å¼ã€‚</p>

<h3 id="å¼€é—­åŸåˆ™">å¼€é—­åŸåˆ™</h3>
<blockquote>
  <p>å¼€é—­åŸåˆ™(Open-Closed Principle, OCP), ä¸€ä¸ªè½¯ä»¶å®ä½“åº”è¯¥å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚å³è½¯ä»¶å®ä½“åº”è¯¥åœ¨å°½é‡ä¸ä¿®æ”¹ä»£ç çš„æƒ…å†µä¸‹è¿›è¡Œæ‰©å±•ã€‚åœ¨è¯¥åŸåˆ™ä¸­ï¼Œè½¯ä»¶å®ä½“å¯ä»¥æŒ‡ä¸€ä¸ªè½¯ä»¶æ¨¡å—ï¼Œä¸€ä¸ªç”±å¤šä¸ªç±»ç»„æˆçš„å±€éƒ¨ç»“æ„æˆ–è€…ä¸€ä¸ªç‹¬ç«‹çš„ç±»ã€‚</p>
</blockquote>

<p>å¼€é—­åŸåˆ™æ˜¯é¢å‘å¯¹è±¡çš„å¯å¤ç”¨è®¾è®¡çš„ç¬¬ä¸€å—åŸºçŸ³ï¼Œä»–æ˜¯æœ€é‡è¦çš„è®¾è®¡åŸåˆ™ã€‚ä¸ºäº†æ»¡è¶³å¼€é—­åŸåˆ™ï¼Œéœ€è¦å¯¹ç³»ç»Ÿè¿›è¡ŒæŠ½è±¡åŒ–è®¾è®¡ï¼ŒæŠ½è±¡æ˜¯å¼€é—­åŸåˆ™çš„å…³é”®ã€‚</p>

<h3 id="é‡Œå¼æ›¿æ¢åŸåˆ™">é‡Œå¼æ›¿æ¢åŸåˆ™</h3>
<blockquote>
  <p>Liskov Substitution Principle(LSP)ï¼Œé‡Œå¼æ›¿æ¢åŸåˆ™ï¼Œè¯¥åŸåˆ™è§„å®šâ€œå­ç±»å¿…é¡»èƒ½å¤Ÿæ›¿æ¢å…¶çˆ¶ç±»ï¼Œå¦åˆ™ä¸åº”å½“è®¾è®¡ä¸ºå…¶å­ç±»â€ã€‚æ¢å¥è¯è¯´ï¼Œçˆ¶ç±»å‡ºç°çš„åœ°æ–¹ï¼Œéƒ½åº”è¯¥èƒ½å¤Ÿç”±å…¶å­ç±»ä»£æ›¿ã€‚æ‰€ä»¥å­ç±»åªèƒ½å»æ‰©å±•åŸºç±»ï¼Œè€Œä¸æ˜¯éšè—æˆ–åˆ™è¦†ç›–åŸºç±»ã€‚</p>
</blockquote>

<h3 id="ä¾èµ–å€’ç½®åŸåˆ™">ä¾èµ–å€’ç½®åŸåˆ™</h3>
<blockquote>
  <p>Dependence Iversion Principle(DIP), å®ƒè®²çš„æ˜¯â€œè®¾è®¡å’Œå®ç°è¦ä¾èµ–äºæŠ½è±¡è€Œéå®ä½“â€ã€‚ä¸€æ–¹é¢æŠ½è±¡åŒ–æ›´ç¬¦åˆäººçš„æ€ç»´ä¹ æƒ¯ï¼›å¦ä¸€æ–¹é¢ï¼Œæ ¹æ®é‡Œå¼æ›¿æ¢åŸåˆ™ï¼Œå¯ä»¥å¾ˆå®¹æ˜“å°†æŠ½è±¡æ›¿æ¢ä¸ºæ‰©å±•åçš„å…·ä½“ï¼Œè¿™æ ·å¯ä»¥å¾ˆå¥½çš„æ”¯æŒå¼€é—­åŸåˆ™ã€‚</p>
</blockquote>

<p>è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œåœ¨å…¬å¸çš„Springé¡¹ç›®å¼€å‘ä¸­ï¼Œå„ä¸ªå±‚æ¬¡é—´é€šè¿‡<code class="language-plaintext highlighter-rouge">Interface</code>è¿›è¡Œä¾èµ–ï¼Œä¹Ÿå°±æ˜¯åŸºäºæ­¤åŸåˆ™ã€‚</p>

<h3 id="æ¥å£éš”ç¦»åŸåˆ™">æ¥å£éš”ç¦»åŸåˆ™</h3>
<blockquote>
  <p>Interface Segration Principle(ISP)ï¼Œâ€œå°†å¤§çš„æ¥å£æ‰“æ•£æˆå¤šä¸ªå°çš„ç‹¬ç«‹çš„æ¥å£â€ã€‚ç”±äºJavaç±»æ”¯æŒå®ç°å¤šä¸ªæ¥å£ï¼Œå¯ä»¥å¾ˆå®¹æ˜“çš„è®©ç±»å…·æœ‰å¤šç§æ¥å£çš„ç‰¹å¾ï¼ŒåŒæ—¶æ¯ä¸ªç±»å¯ä»¥é€‰æ‹©æ€§åœ°åªå®ç°ç›®æ ‡æ¥å£ã€‚</p>
</blockquote>

<h3 id="å•ä¸€èŒè´£åŸåˆ™">å•ä¸€èŒè´£åŸåˆ™</h3>
<blockquote>
  <p>Single Responsibility Principle(SRP),å•ä¸€èŒè´£åŸåˆ™ã€‚å®ƒè®²çš„æ˜¯ä¸è¦å­˜åœ¨å¤šäºä¸€ä¸ªå¯¼è‡´ç±»å˜æ›´çš„åŸå› ï¼Œæ˜¯é«˜å†…èšï¼Œä½è€¦åˆçš„ä¸€ä¸ªä½“ç°ã€‚</p>
</blockquote>

<h3 id="è¿ªç±³ç‰¹æ³•åˆ™">è¿ªç±³ç‰¹æ³•åˆ™</h3>
<blockquote>
  <p>Law of Demeter or Least Knowledge Principle(LoD or LKP)ï¼Œâ€œä¸€ä¸ªå¯¹è±¡å°±å°½å¯èƒ½å°‘çš„äº†è§£å…¶å®ƒå¯¹è±¡â€ï¼Œä»è€Œå®ç°æ¾è€¦åˆã€‚å¦‚æœä¸€ä¸ªç±»çš„èŒè´£è¿‡å¤šï¼Œç”±äºå¤šä¸ªèŒè´£è€¦åˆåœ¨äº†ä¸€èµ·ï¼Œä»»ä½•ä¸€ä¸ªèŒè´£çš„å˜æ›´éƒ½å¯èƒ½å¼•èµ·å…¶å®ƒèŒè´£çš„é—®é¢˜ï¼Œä¸¥é‡å½±å“ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯é‡ç”¨æ€§ã€‚</p>
</blockquote>

<p>è¯¥æ³•åˆ™å®é™…ä¸Šå’Œå•ä¸€èŒè´£åŸåˆ™å¾ˆç±»ä¼¼ï¼Œå¼ºè°ƒçš„é«˜å†…èšï¼Œä½è€¦åˆã€‚</p>

<h3 id="åˆæˆèšåˆå¤ç”¨åŸåˆ™">åˆæˆ/èšåˆå¤ç”¨åŸåˆ™</h3>
<blockquote>
  <p>Composite/Aggregate Reuse Principle(CARP/CRP)ï¼Œåˆæˆ/èšåˆå¤ç”¨åŸåˆ™ã€‚å¦‚æœæ–°å¯¹è±¡çš„æŸäº›åŠŸèƒ½åœ¨åˆ«çš„å·²ç»åˆ›å»ºå¥½çš„å¯¹è±¡é‡Œé¢å·²ç»å®ç°ï¼Œé‚£ä¹ˆåº”å½“å°½é‡ä½¿ç”¨åˆ«çš„å¯¹è±¡æä¾›çš„åŠŸèƒ½ï¼Œä½¿ä¹‹æˆä¸ºæ–°å¯¹è±¡çš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸è¦åœ¨é‡æ–°åˆ›å»ºã€‚æ–°å¯¹è±¡å¯ä»¥é€šè¿‡å‘è¿™äº›å¯¹è±¡çš„å§”æ´¾è¾¾åˆ°å¤ç”¨å·²æœ‰åŠŸèƒ½çš„æ•ˆæœã€‚ç®€è€Œè¨€ä¹‹ï¼Œå°½é‡ä½¿ç”¨åˆæˆ/èšåˆï¼Œè€Œéä½¿ç”¨ç»§æ‰¿ã€‚</p>
</blockquote>

<p>è¿™ä¸ªåŸåˆ™ä¹ä¸€çœ‹å’Œè¿ªç±³ç‰¹æ³•åˆ™ç›¸æ‚–ï¼Œä½†æˆ‘çš„ç†è§£æ˜¯ï¼Œå¯ä»¥å¤ç”¨çš„åŠŸèƒ½åº”è¯¥æ˜¯æœ‰å¥½çš„æŠ½è±¡å¾—åˆ°ï¼Œè€Œä¸æ˜¯èƒ¡ä¹±çš„å¤ç”¨ï¼Œè¿™é‡Œé¢å…¶å®éƒ½æ˜¯è€ƒéªŒå·¥ç¨‹å¸ˆåŠŸåŠ›çš„åœ°æ–¹ã€‚</p>

<h3 id="å…³äºé™æ€æ–¹æ³•">å…³äºé™æ€æ–¹æ³•</h3>
<p>é™æ€æ–¹æ³•å®é™…æ˜¯æ— çŠ¶æ€ä¸”é¢å‘æ–¹æ³•çš„è®¾è®¡ï¼Œé€‚åˆç”¨ä½œå·¥å…·ç±»ï¼Œæ¯”å¦‚<code class="language-plaintext highlighter-rouge">Guava</code>ï¼Œè€Œä¸é€‚åˆç”¨åœ¨å¯¹è±¡ä¸­ã€‚ä¸è¿‡åœ¨<code class="language-plaintext highlighter-rouge">Java8</code>ä¸­å·²ç»æ”¯æŒäº†<code class="language-plaintext highlighter-rouge">interface</code>ä¸­çš„é™æ€æ–¹æ³•ï¼Œä¹Ÿåº”è¯¥æ˜¯ä½œä¸ºå®ç°ç±»éœ€è¦çš„å·¥å…·æ–¹æ³•å­˜åœ¨ã€‚</p>

<h2 id="å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼">å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼</h2>

<h3 id="builderæ¨¡å¼">Builderæ¨¡å¼</h3>
<p>Builderæ¨¡å¼éå¸¸é€‚ç”¨äºéœ€è¦å¤šä¸ªæ„é€ å‚æ•°çš„åœºæ™¯ï¼Œç›¸æ¯”äº<code class="language-plaintext highlighter-rouge">new</code>ä¸€ä¸ªå¯¹è±¡ï¼Œç„¶åç”¨ä¸€å †<code class="language-plaintext highlighter-rouge">setter</code>å»èµ‹å€¼çš„æ–¹å¼ï¼Œè¿™ç§æ¨¡å¼çš„å¯è¯»æ€§æ˜¾ç„¶è¦å¼ºå¾ˆå¤šã€‚åœ¨æˆ‘çš„é¡¹ç›®ä¸­ï¼Œéœ€è¦è°ƒç”¨å…¶å®ƒç³»ç»Ÿçš„RestæœåŠ¡ï¼Œåœ¨æ‹¼æ¥URLæ—¶ï¼Œç”¨è¿™ç§æ¨¡å¼å°±éå¸¸æ–¹ä¾¿ã€‚</p>

<h4>åŸºç±»</h4>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="cm">/**
 * è¯·æ±‚æ„é€ å™¨åŸºæœ¬ç±»
 * Created by huanghuan on 2016/12/10.
 */</span>
<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">AbstractURLBuilder</span> <span class="o">{</span>
    <span class="kd">protected</span> <span class="nc">String</span> <span class="n">params</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>
    <span class="kd">protected</span> <span class="nc">String</span> <span class="n">prefix</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>

    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">appendParams</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">String</span> <span class="n">param</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">name</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">param</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">params</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">params</span> <span class="o">+=</span> <span class="n">name</span> <span class="o">+</span> <span class="s">"="</span> <span class="o">+</span> <span class="n">param</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">params</span> <span class="o">+=</span> <span class="s">"&amp;"</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">"="</span> <span class="o">+</span> <span class="n">param</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="cm">/**
     * ç”Ÿæˆæœ€åæŸ¥è¯¢ç”¨çš„URLåœ°å€
     */</span>
    <span class="kd">public</span> <span class="kd">abstract</span> <span class="nc">String</span> <span class="nf">build</span><span class="o">();</span>

    <span class="cm">/**
     * éœ€è¦è®¾ç½®è¯·æ±‚çš„å‰ç¼€ï¼Œæ¯”å¦‚http://address/service?
     *
     * @param prefix å‰ç¼€
     */</span>
    <span class="kd">public</span> <span class="nf">AbstractQueryBuilder</span><span class="o">(</span><span class="nc">String</span> <span class="n">prefix</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">prefix</span> <span class="o">=</span> <span class="n">prefix</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>å…¶ä¸­åŒ…å«äº†åŸºæœ¬çš„<code class="language-plaintext highlighter-rouge">prefix</code>å‰ç¼€å’Œ<code class="language-plaintext highlighter-rouge">params</code>å‚æ•°ã€‚</p>

<h4>å®ç°ç±»</h4>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="cm">/**
 * è¯­éŸ³åœ°å€
 * Created by huanghuan on 2016/12/14.
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">VoiceBuilder</span> <span class="kd">extends</span> <span class="nc">AbstractURLBuilder</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="nf">VoiceBuilder</span><span class="o">(</span><span class="nc">String</span> <span class="n">prefix</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">prefix</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">VoiceBuilder</span> <span class="nf">rate</span><span class="o">(</span><span class="nc">String</span> <span class="n">rate</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">appendParams</span><span class="o">(</span><span class="s">"rate"</span><span class="o">,</span> <span class="n">rate</span><span class="o">);</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">VoiceBuilder</span> <span class="nf">le</span><span class="o">(</span><span class="nc">String</span> <span class="n">le</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">appendParams</span><span class="o">(</span><span class="s">"le"</span><span class="o">,</span> <span class="n">le</span><span class="o">);</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">VoiceBuilder</span> <span class="nf">audio</span><span class="o">(</span><span class="nc">String</span> <span class="n">audio</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">appendParams</span><span class="o">(</span><span class="s">"audio"</span><span class="o">,</span> <span class="n">audio</span><span class="o">);</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">build</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">params</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>è¿™é‡Œå®šä¹‰ä¸€ä¸ªè¯­éŸ³æŸ¥è¯¢æœåŠ¡çš„Builderï¼Œå®é™…ä¸Šåœ¨<code class="language-plaintext highlighter-rouge">build()</code>ä¸­ï¼Œæ ¹æ®éœ€æ±‚è¿˜å¯ä»¥è®¾ç½®ä¸€äº›é»˜è®¤å‚æ•°ï¼Œæ‰€ä»¥æ‰åŸºç±»ä¸­å°†å…¶å®šä¹‰ä¸ºè™šæ–¹æ³•ã€‚</p>

<h4>ä½¿ç”¨</h4>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span> <span class="n">args</span><span class="o">[]){</span>
	<span class="nc">String</span> <span class="n">voiceURL</span><span class="o">=</span><span class="k">new</span> <span class="nc">VoiceBuilder</span><span class="o">(</span><span class="s">"http://address/service?"</span><span class="o">)</span>
	<span class="o">.</span><span class="na">rate</span><span class="o">(</span><span class="s">"whatever"</span><span class="o">).</span><span class="na">le</span><span class="o">(</span><span class="s">"EN"</span><span class="o">).</span><span class="na">audio</span><span class="o">(</span><span class="s">"good"</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure>

<p>æ˜¯ä¸æ˜¯å¾ˆç®€æ´ä¸”æ–¹ä¾¿ã€‚</p>

<h3 id="ç­–ç•¥æ¨¡å¼å’Œç®€å•å·¥å‚æ¨¡å¼">ç­–ç•¥æ¨¡å¼å’Œç®€å•å·¥å‚æ¨¡å¼</h3>
<p>ç­–ç•¥æ¨¡å¼åœ¨å„ç±»ç³»ç»Ÿä¸­éƒ½å¾ˆå¸¸è§ï¼Œå…¶å®ç°ä¹Ÿå¾ˆç®€å•ï¼Œå®šä¹‰å¥½<code class="language-plaintext highlighter-rouge">interface</code>å³å¯ï¼Œä¸åŒçš„ç­–ç•¥é—´åº”è¯¥æ»¡è¶³éš”ç¦»å’Œå•ä¸€èŒè´£åŸåˆ™ï¼Œç›¸äº’é—´ç‹¬ç«‹è€Œä¸è€¦åˆã€‚å»¶ç»­åˆšæ‰çš„ä¾‹å­ï¼Œå½“ä¸€ä¸ªæœåŠ¡éœ€è¦æ ¹æ®è¾“å…¥å‚æ•°çš„ä¸åŒï¼Œå»è°ƒç”¨ä¸åŒçš„æœåŠ¡æ—¶ï¼Œç­–ç•¥æ¨¡å¼å°±éå¸¸åˆé€‚äº†ã€‚</p>

<h4>ç­–ç•¥æ¨¡å¼ç±»å›¾</h4>

<p><img src="/pics/strategy.png" alt="strategy" /></p>

<h4>å®šä¹‰Interface</h4>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="cm">/**
 * Apiè°ƒç”¨ç­–ç•¥æ¥å£
 * Created by huanghuan on 2016/12/17.
 */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ApiStrategy</span> <span class="o">{</span>

    <span class="cm">/**
     * è·å–apiè°ƒç”¨ç»“æœ
     *
     * @param requestParams è¯·æ±‚å‚æ•°
     * @return apiçš„æŸ¥è¯¢ç»“æœ
     */</span>
    <span class="nd">@NotNull</span>
    <span class="nc">JSONObject</span> <span class="nf">getApiRequest</span><span class="o">(</span><span class="nc">RequestParams</span> <span class="n">requestParams</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ApiException</span><span class="o">;</span>
<span class="o">}</span></code></pre></figure>

<h4>å®šä¹‰å®ç°ç­–ç•¥</h4>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">DemoStrategy</span> <span class="kd">implements</span> <span class="nc">ApiStrategy</span> <span class="o">{</span>

	<span class="nd">@NotNull</span>
	<span class="kd">public</span> <span class="nc">JSONObject</span> <span class="nf">getApiRequest</span><span class="o">(</span><span class="nc">RequestParams</span> <span class="n">requestParams</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ApiException</span> <span class="o">{</span>
    	<span class="cm">/** å®ç° */</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<h4>å®šä¹‰å·¥å‚</h4>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="cm">/**
 * ç­–ç•¥æ¨¡å¼ç®¡ç†è€…ï¼Œå†³å®šApiçš„è°ƒç”¨ç­–ç•¥
 * Created by huanghuan on 2016/12/17.
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ApiStrategyFactory</span> <span class="o">{</span>
    <span class="cm">/**
     * å†³å®šapiçš„å®é™…è°ƒç”¨ç­–ç•¥
     *
     * @param requestParams è¯·æ±‚å‚æ•°
     * @return å…·ä½“çš„apiè°ƒç”¨ç­–ç•¥
     */</span>
    <span class="kd">public</span> <span class="nc">ApiStrategy</span> <span class="nf">decideStrategy</span><span class="o">(</span><span class="nc">RequestParams</span> <span class="n">requestParams</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ApiException</span> <span class="o">{</span>
    	<span class="cm">/** æ ¹æ®requestParamså†³å®šè°ƒç”¨çš„ç­–ç•¥ */</span>
        <span class="k">if</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">DemoStrategy</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">whatever</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<h4>ä½¿ç”¨</h4>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span> <span class="n">args</span><span class="o">[]){</span>
	<span class="nc">RequestParams</span> <span class="n">req</span><span class="o">=</span><span class="k">new</span> <span class="nc">RequestParams</span><span class="o">();</span>
	<span class="k">new</span> <span class="nf">ApiStrategyFactory</span><span class="o">().</span><span class="na">decideStrategy</span><span class="o">(</span><span class="n">req</span><span class="o">).</span><span class="na">getApiResult</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure>

<p>è¿™æ ·çš„ç­–ç•¥ä¹‹åæ·»åŠ ä¿®æ”¹ç­–ç•¥éƒ½ä¼šå¾ˆæ–¹ä¾¿ï¼Œå½“ç„¶ç®€å•å·¥å‚æ–¹æ³•ä¸æ»¡è¶³å¼€é—­æ¡ä»¶ï¼Œé€‚ç”¨äºç­–ç•¥è¾ƒå°‘çš„åœºæ™¯ã€‚</p>

<h3 id="è´£ä»»é“¾æ¨¡å¼">è´£ä»»é“¾æ¨¡å¼</h3>
<p>å½“éœ€è¦ä¾æ¬¡å¤„ç†ä¸€ä¸ªä»»åŠ¡æ—¶ï¼Œå¯ä»¥é‡‡ç”¨è´£ä»»é“¾æ¨¡å¼ï¼Œè¿™ä¸ªæ¨¡å¼å¯å®é™…åº”ç”¨åœ¨å‚æ•°æ ¡éªŒï¼Œæˆ–åˆ™æµç¨‹å¤„ç†ä¸­ï¼ˆæ¯”å¦‚SpringMVCçš„9å¤§handlerï¼Œä¹Ÿå°±æ˜¯ç”¨ç±»ä¼¼çš„æ¨¡å¼ä¾æ¬¡äº§ç”Ÿä½œç”¨ï¼‰</p>

<h4>å®šä¹‰åŸºç±»</h4>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Handler</span> <span class="o">{</span>

    <span class="kd">protected</span> <span class="nc">Handler</span> <span class="n">nextHandler</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">handle</span><span class="o">();</span>

    <span class="kd">public</span> <span class="nc">Handler</span> <span class="nf">getNextHandler</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">nextHandler</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setNextHandler</span><span class="o">(</span><span class="nc">Handler</span> <span class="n">handler</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">nextHandler</span> <span class="o">=</span> <span class="n">handler</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<h4>å®šä¹‰å­ç±»</h4>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Father</span> <span class="kd">extends</span> <span class="nc">Handler</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handle</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"father is called"</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">nextHandler</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">getNextHandler</span><span class="o">().</span><span class="na">handle</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Son</span> <span class="kd">extends</span> <span class="nc">Handler</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handle</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"son is called"</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">nextHandler</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">getNextHandler</span><span class="o">().</span><span class="na">handle</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GrandSon</span> <span class="kd">extends</span> <span class="nc">Handler</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handle</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"grand son is called"</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">nextHandler</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">getNextHandler</span><span class="o">().</span><span class="na">handle</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<h4>ä½¿ç”¨</h4>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Father</span> <span class="n">father</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Father</span><span class="o">();</span>
    <span class="nc">Son</span> <span class="n">son</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Son</span><span class="o">();</span>
    <span class="nc">GrandSon</span> <span class="n">grandSon</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">GrandSon</span><span class="o">();</span>
    <span class="n">father</span><span class="o">.</span><span class="na">setNextHandler</span><span class="o">(</span><span class="n">son</span><span class="o">);</span>
    <span class="n">son</span><span class="o">.</span><span class="na">setNextHandler</span><span class="o">(</span><span class="n">grandSon</span><span class="o">);</span>
    <span class="n">father</span><span class="o">.</span><span class="na">handle</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure>

<h3 id="è£…é¥°å™¨æ¨¡å¼">è£…é¥°å™¨æ¨¡å¼</h3>

<p><img src="/pics/decorate.png" alt="screen" /></p>

<p>è£…é¥°å™¨æ¨¡å¼ä¸»è¦çš„ä½œç”¨æ˜¯ä¸ºç°æœ‰çš„ç±»å¢åŠ æ–°çš„åŠŸèƒ½ï¼Œå…¶ä½¿ç”¨å’Œå®ç°å’Œä»£ç†æ¨¡å¼å¾ˆåƒï¼Œä¸»è¦çš„åŒºåˆ«åœ¨äºæ§åˆ¶æƒçš„è½¬ç§»ï¼Œä»£ç†æ¨¡å¼å¼ºè°ƒè®¿é—®å¿…é¡»ç»ç”±ä»£ç†ï¼Œè€Œè£…é¥°å™¨æ¨¡å¼å¹¶æ— æ­¤çº¦å®šã€‚æˆ‘ä»¬ç»å¸¸ç”¨åˆ°çš„Java IOç±»ï¼Œä¾¿æ˜¯è£…é¥°å™¨æ¨¡å¼çš„å®ç°ã€‚</p>

<h4>åŸºç±»</h4>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Component</span><span class="o">{</span>
  <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">operation</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Decorator</span> <span class="kd">extends</span> <span class="nc">Component</span><span class="o">{</span>
  <span class="kd">protected</span> <span class="nc">Component</span> <span class="n">component</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">Decorator</span><span class="o">(</span><span class="nc">Component</span> <span class="n">component</span><span class="o">){</span>
    <span class="k">this</span><span class="o">.</span><span class="na">component</span><span class="o">=</span><span class="n">component</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">operation</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure>

<h4>å®ç°ç±»</h4>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConcreteComponent</span> <span class="kd">extends</span> <span class="nc">Component</span><span class="o">{</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">operation</span><span class="o">(){</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"## doing something ##"</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConcreteDecorator</span> <span class="kd">extends</span> <span class="nc">Decorator</span><span class="o">{</span>
  <span class="kd">public</span> <span class="nf">ConcreteDecorator</span><span class="o">(</span><span class="nc">Component</span> <span class="n">component</span><span class="o">){</span>
    <span class="kd">super</span><span class="o">(</span><span class="n">component</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">decorateMethod</span><span class="o">(){</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"## decorating ##"</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">operation</span><span class="o">(){</span>
    <span class="n">decorateMethod</span><span class="o">();</span>
    <span class="n">component</span><span class="o">.</span><span class="na">operation</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<h4>ä½¿ç”¨</h4>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
  <span class="nc">Component</span> <span class="n">component</span><span class="o">=</span><span class="k">new</span> <span class="nc">ConcreteDecorator</span><span class="o">(</span><span class="k">new</span> <span class="nc">ConcreteComponent</span><span class="o">());</span>
  <span class="n">component</span><span class="o">.</span><span class="na">operation</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure>

<h3 id="è§‚å¯Ÿè€…æ¨¡å¼">è§‚å¯Ÿè€…æ¨¡å¼</h3>

<p><img src="/pics/observer.png" alt="observer" /></p>

<p>è§‚å¯Ÿè€…æ¨¡å¼åœ¨è®¾è®¡ä¸­éå¸¸å¸¸è§ï¼Œç³»ç»Ÿå±‚é¢åƒZookeeperï¼ŒJQueryäº‹ä»¶ç­‰å¤šæ˜¯ä½¿ç”¨çš„è¯¥æ¨¡å¼ã€‚</p>

<h4>ä¸»é¢˜</h4>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Subject</span> <span class="o">{</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Observer</span><span class="o">&gt;</span> <span class="n">observers</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Observer</span><span class="o">&gt;();</span>

    <span class="kt">void</span> <span class="nf">attach</span><span class="o">(</span><span class="nc">Observer</span> <span class="n">observer</span><span class="o">);</span>

    <span class="kt">void</span> <span class="nf">detach</span><span class="o">(</span><span class="nc">Observer</span> <span class="n">observer</span><span class="o">);</span>

    <span class="kt">void</span> <span class="nf">notifyObserver</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">ConcreteSubject</span> <span class="kd">implements</span> <span class="nc">Subject</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">attach</span><span class="o">(</span><span class="nc">Observer</span> <span class="n">observer</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">observers</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">observer</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">detach</span><span class="o">(</span><span class="nc">Observer</span> <span class="n">observer</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Iterator</span><span class="o">&lt;</span><span class="nc">Observer</span><span class="o">&gt;</span> <span class="n">iterator</span> <span class="o">=</span> <span class="n">observers</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
        <span class="k">while</span> <span class="o">(</span><span class="n">iterator</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
            <span class="nc">Observer</span> <span class="n">observerTemp</span> <span class="o">=</span> <span class="n">iterator</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">observerTemp</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">observer</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">iterator</span><span class="o">.</span><span class="na">remove</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">notifyObserver</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">Observer</span> <span class="n">observerTemp</span> <span class="o">:</span> <span class="n">observers</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">observerTemp</span><span class="o">.</span><span class="na">printMessage</span><span class="o">(</span><span class="s">"this is a test"</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<h4>è§‚å¯Ÿè€…</h4>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Observer</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">printMessage</span><span class="o">(</span><span class="nc">String</span> <span class="n">message</span><span class="o">);</span>
<span class="o">}</span>

<span class="nd">@Data</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">ConcreteObserver</span> <span class="kd">implements</span> <span class="nc">Observer</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">ConcreteObserver</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">printMessage</span><span class="o">(</span><span class="nc">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">name</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">message</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<h4>ä½¿ç”¨</h4>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Subject</span> <span class="n">subject</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ConcreteSubject</span><span class="o">();</span>
    <span class="nc">Observer</span> <span class="n">observer1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ConcreteObserver</span><span class="o">(</span><span class="s">"one"</span><span class="o">);</span>
    <span class="nc">Observer</span> <span class="n">observer2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ConcreteObserver</span><span class="o">(</span><span class="s">"two"</span><span class="o">);</span>
    <span class="n">subject</span><span class="o">.</span><span class="na">attach</span><span class="o">(</span><span class="n">observer1</span><span class="o">);</span>
    <span class="n">subject</span><span class="o">.</span><span class="na">attach</span><span class="o">(</span><span class="n">observer2</span><span class="o">);</span>
    <span class="n">subject</span><span class="o">.</span><span class="na">notifyObserver</span><span class="o">();</span>
    <span class="n">subject</span><span class="o">.</span><span class="na">detach</span><span class="o">(</span><span class="n">observer1</span><span class="o">);</span>
    <span class="n">subject</span><span class="o">.</span><span class="na">notifyObserver</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure>

:ET